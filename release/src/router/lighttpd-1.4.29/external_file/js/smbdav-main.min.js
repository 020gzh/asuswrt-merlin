var g_support_html5=0,g_reload_page=1,m=new lang,g_storage=new myStorage,g_listview=g_storage.get("listview")==void 0?0:g_storage.get("listview"),g_modal_url,g_modal_window_width=200,g_modal_window_height=100,timer_idle,g_show_modal=0,g_time_out=9E5,g_time_count=0,g_select_mode=0,g_select_array,g_upload_mode=0,client=new davlib.DavClient;client.initialize();g_support_html5=window.File&&window.FileReader&&window.FileList&&window.Blob?1:0;
function getUrlVars(){for(var a=[],d,c=window.location.href.slice(window.location.href.indexOf("?")+1).split("&"),e=0;e<c.length;e++)d=c[e].split("="),a.push(d[0]),a[d[0]]=d[1];return a}function getFileExt(a){a=/^.+\.([^.]+)$/.exec(a);return a==null?"":a[1].toLowerCase()}function addPathSlash(a){if(a.lastIndexOf("/")==a.length-1)return a;a+="/";return a}function size_format(a){for(var d=0;a>=1024;)a/=1024,++d;return a.toFixed(1)+" "+["B","KB","MB","GB","TB","PB","EB","ZB","YB"][d]}
function mydecodeURI(a){a=decodeURI(a);a=String(a).replace("%22",'"');a=String(a).replace("%23","#");a=String(a).replace("%24","$");a=String(a).replace("%25","%");a=String(a).replace("%26","&");a=String(a).replace("%2b","+");return a=String(a).replace("%40","@")}
function myencodeURI(a){a=String(a).replace("%","%25");a=String(a).replace('"',"%22");a=String(a).replace("#","%23");a=String(a).replace("$","%24");a=String(a).replace("&","%26");a=String(a).replace("+","%2b");a=String(a).replace("@","%40");return a=encodeURI(a)}function doRescanSamba(){var a=addPathSlash(g_storage.get("openurl"));closeJqmWindow(0);showHideLoadStatus(!0);client.RESCANSMBPC(a,function(a){a[0]==2&&(g_storage.set("HostList",""),doPROPFIND("/"))})}
function doMKDIR(a){var d=addPathSlash(g_storage.get("openurl")),c=d+myencodeURI(a),e=0;$("a#list_item").each(function(){$(this).attr("isdir")=="1"&&a==$(this).attr("title")&&(e=1,alert(m.getString("folder_already_exist_msg")))});e!=1&&client.MKCOL(c,function(a){a[0]==2?(doPROPFIND(d),closeJqmWindow(0)):alert(m.getString(a))})}
function doRENAME(a,d){var c=0,e=addPathSlash(g_storage.get("openurl")),b=e+encodeURI(d);$("a#list_item").each(function(){$(this).attr("isdir")=="1"&&d==$(this).attr("title")&&(c=1,alert(m.getString("folder_already_exist_msg")))});c!=1&&client.MOVE(a,b,function(a){a[0]==2?(doPROPFIND(e),closeJqmWindow(0)):alert(m.getString(a))})}function getFileViewHeight(){return $("#fileview").height()}
function closeUploadPanel(a){g_upload_mode=0;g_reload_page=a;g_storage.set("stopLogoutTimer","0");$("div#btnNewDir").css("display","block");g_support_html5==1&&$("div#btnUpload").css("display","block");$("div#btnSelect").css("display","block");$("div#btnCancelUpload").css("display","none");$("#function_help").text("");$("#upload_panel").animate({left:"1999px"},"slow",null,function(){$("#upload_panel").css("display","none");adjustLayout()});a==1&&(a=addPathSlash(g_storage.get("openurl")),doPROPFIND(a))}
function cancelSelectMode(){g_select_mode!=0&&(g_select_mode=0,g_select_array=null,$("#btnDownload").addClass("disable"),$("#btnShareLink").addClass("disable"),$("#btnDeleteSel").addClass("disable"),$("#btnRename").addClass("disable"),$("div#btnNewDir").css("display","block"),g_support_html5==1&&$("div#btnUpload").css("display","block"),$("div#btnSelect").css("display","block"),$("div#btnCancelSelect").css("display","none"),$(".selectDiv").css("display","none"),$(".selectHintDiv").css("display","none"),
$("#fileview #fileviewicon").each(function(){$(this).removeClass("select")}),$("#function_help").text(""),$("#button_panel").animate({left:"1999px"},"slow",null,function(){adjustLayout()}))}
function adjustLayout(){var a=getPageSize()[1]-$("#header_region").height()-$("#bottom_region").height();$("#main_region").css("height",a);var a=$("#main_left_region").height()-$("#infobar").height()-$("#settingbar").height(),d=Math.max(Math.floor(a/40),1)*40;$("#hostview").css("height",d);$("#settingbar").css("padding-top",a-d);a=g_select_mode==1?$("#main_right_container").height()-$("#infobar").height()-$("#button_panel").height():$("#main_right_container").height()-$("#infobar").height();$("#fileview").css("height",
a);$("#function_help").css("left",$("#main_left_region").width())}function closeJqmWindow(a){g_reload_page=a;a=$("div#modalWindow");$("iframe",a).attr("src","");a&&a.jqmHide();showHideLoadStatus(!1)}function fullscreenJqmWindow(){var a=$("div#modalWindow");a&&(a.css("left","0px"),a.css("top","0px"),a.css("width",window.width+"px"),a.css("height",window.height+"px"))}
function doLOGOUT(){doPROPFIND("/",function(){addPathSlash(g_storage.get("openurl"));client.LOGOUT("/",function(a){if(a[0]==2)g_storage.set("openhostuid","0"),window.location="/smb/css/logout.html"})},0)}function resetTimer(){clearInterval(timer_idle);g_time_count=0;timer_idle=setInterval(function(){g_storage.get("stopLogoutTimer")=="1"||g_show_modal==1?g_time_count=0:(g_time_count++,g_time_count*1E3>g_time_out&&(g_time_count=0,doLOGOUT()))},1E3)}
String.prototype.width=function(a){var a=a||"12px arial",a=$("<div>"+this+"</div>").css({position:"absolute","float":"left","white-space":"nowrap",visibility:"hidden",font:a}).appendTo($("body")),d=a.width();a.remove();return d};
function createOpenUrlUI(a){var d=mydecodeURI(a),c="",e="",b="",f=$("#urlregion-url").width();if(d!="/")for(var d=d.split("/"),a=a.split("/"),g=0;g<d.length;g++)if(d[g]!=""){e+="/"+a[g];b+=" / <a id='url_path' uhref='"+e+"'>"+d[g]+"</a>";if(String(b).width($("p#openurl").css("font"))>f){c+=" / ...";break}c+=" / <a id='url_path' uhref='"+e+"'>"+d[g]+"</a>";b=c}$("p#openurl").empty();$("p#openurl").append(c);$("a#url_path").click(function(){doPROPFIND($(this).attr("uhref"))})}
function doPROPFIND(a,d,c){if(client!=null){showHideLoadStatus(!0);cancelSelectMode();try{client.PROPFIND(a,c,function(c,e,g){if(c)if(c==207){var n,i,c=[],e=[];if(window.DOMParser)n=new DOMParser,i=n.parseFromString(g,"text/xml");else if(i=new ActiveXObject("Microsoft.XMLDOM"),i.async="false",i.loadXML(g),!i.documentElement){alert("Fail to load xml!");showHideLoadStatus(!1);return}var l,o,h,r;n=i.documentElement.childNodes;g=i.documentElement.getAttribute("qtype");i.documentElement.getAttribute("readonly");
i.documentElement.getAttribute("ruser");i.documentElement.getAttribute("computername");for(i=0;i<n.length;i++){var p="",v="",w="",q="",t="",x="",y="",z="",A="",B="",C="",D="",E="",k,s=n[i].childNodes;for(l=0;l<s.length;l++)if(s[l].nodeType==1&&s[l].nodeName=="D:propstat"){var F=s[l].childNodes;for(o=0;o<F.length;o++)if(F[o].nodeName=="D:prop"){var j=F[o].childNodes;for(h=0;h<j.length;h++)if(!(j[h].childNodes.length<=0))if(j[h].nodeName=="D:getcontenttype")v=String(j[h].childNodes[0].nodeValue);else if(j[h].nodeName==
"D:getuniqueid")w=String(j[h].childNodes[0].nodeValue);else if(j[h].nodeName=="D:getonline")x=String(j[h].childNodes[0].nodeValue);else if(j[h].nodeName=="D:getlastmodified")y=String(j[h].childNodes[0].nodeValue);else if(j[h].nodeName=="D:getcontentlength")z=String(size_format(parseInt(j[h].childNodes[0].nodeValue)));else if(j[h].nodeName=="D:getmac")B=String(j[h].childNodes[0].nodeValue);else if(j[h].nodeName=="D:getip")A=String(j[h].childNodes[0].nodeValue);else if(j[h].nodeName=="D:gettype")C=
String(j[h].childNodes[0].nodeValue);else if(j[h].nodeName=="D:getattr"){var u=j[h].childNodes;for(r=0;r<u.length;r++)if(u[r].nodeName=="D:readonly")D=u[r].childNodes[0].nodeValue;else if(u[r].nodeName=="D:hidden")E=u[r].childNodes[0].nodeValue}}}else s[l].nodeType==1&&s[l].nodeName=="D:href"&&(p=String(s[l].childNodes[0].nodeValue),o="",p.match(/^http/)&&(o=window.location.protocol+"//"+window.location.host),h=o+addPathSlash(a),p!=h?(q=a,p=p.replace(o,""),q=p.replace(addPathSlash(q),""),q!=""?(k=
q,t=q=mydecodeURI(q),o=g_listview==0?12:45,t.length>o&&(t=t.substring(0,o)+"...")):p=""):p="");p!=""&&(v=="httpd/unix-directory"?c.push({contenttype:v,href:p,name:q,uname:k,shortname:t,online:x,time:y,size:z,ip:A,mac:B,uid:w,type:C,freadonly:D,fhidden:E}):e.push({contenttype:v,href:p,name:q,uname:k,shortname:t,online:x,time:y,size:z,ip:A,mac:B,uid:w,type:C,freadonly:D,fhidden:E}))}c.sort(sortByName);e.sort(sortByName);for(k=0;k<c.length;k++)if(c[k].type=="usbdisk"){arraymove(c,k,0);break}k=addPathSlash(a);
k!="/"&&(k=k.substring(0,k.length-1),k=k.substring(0,k.lastIndexOf("/")),k==""&&(k="/"));createHostList(g,c);createThumbView(g,k,c,e);g==0&&g_select_mode==0?($("#btnUpload").css("display","block"),$("#btnSelect").css("display","block"),$("#btnNewDir").css("display","block")):($("#btnUpload").css("display","none"),$("#btnSelect").css("display","none"),$("#btnNewDir").css("display","none"));g_support_html5==0&&$("#btnUpload").css("display","none");g_select_mode==1&&$("#btnCancelSelect").css("display",
"block");g_upload_mode==1&&$("#btnCancelUpload").css("display","block");g==1?$("#btnChangeUser").css("display","block"):$("#btnChangeUser").css("display","none");createOpenUrlUI(a);g_storage.set("openurl",a);$("div#hostview").scrollTop(g_storage.get("hostviewscrollTop"));$("div#fileview").scrollLeft(g_storage.get("contentscrollLeft"));$("div#fileview").scrollTop(g_storage.get("contentscrollTop"));showHideLoadStatus(!1);closeJqmWindow(0);d!=void 0&&d()}else c==501?doPROPFIND(a):c==401?setTimeout(function(){var c=
$("div#modalWindow"),b=c.css("display");g_modal_url="/smb/css/login.html?v="+a;g_modal_window_width=365;g_modal_window_height=150;$("#jqmTitleText").text(m.getString("title_login")+" - "+a);b=="block"&&$("#jqmMsgText").text(m.getString("msg_passerror"));$("#jqmMsg").css("display",b);c&&c.jqmShow()},1E3):alert(m.getString(c))},null,1),resetTimer()}catch(e){alert("catch error: "+e)}}}function doLOGIN(a,d){doPROPFIND(a,function(){},d)}
function createHostList(a,d){var c="";$("#hostview").empty();var e=g_storage.get("HostList")?g_storage.get("HostList").split(/,/):[];if(a==2)for(var b=0;b<d.length;b++){var f=d[b].href+"|"+d[b].name+"|"+d[b].online+"|"+d[b].ip+"|"+d[b].mac+"|"+d[b].uid+"|"+d[b].freadonly+"|"+d[b].fhidden+"|"+d[b].type;e.contains(f)||e.push(f);g_storage.set("HostList",e.join(","))}for(b=0;b<e.length;b++)f=e[b].split("|"),c+="<div class='host_item unselectable",f[2]==0&&(c+=" offline"),c+="' uhref='",c+=f[0],c+="' title='",
c+=f[1],c+="' online='",c+=f[2],c+="' isdir='1'",c+=" ip='",c+=f[3],c+="' mac='",c+=f[4],c+="' uid='",c+=f[5],c+="' freadonly='",c+=f[6],c+="' fhidden='",c+=f[7],c+=f[8]=="usbdisk"?"' isusb='1'":"' isusb='0'",c+=">",c+="<div id='hosticon' class='sicon "+f[8],f[2]==0&&(c+="off"),c+="'/>",c+="<div id='hostname' class='unselectable'>",c+="<p>",c+=f[1],f[2]==0&&(c+="("+m.getString("title_offline")+")"),c+="</p>",c+="</div>",c+="</div>";$("#hostview").append(c);var g=g_storage.get("openhostuid");$("#hostview .host_item").each(function(){$(this).attr("uid")==
g?$(this).css("background-color","#009583"):$(this).css("background-color","#014051")});$("#hostview .host_item").click(function(){if($(this).attr("online")==0)confirm(m.getString("wol_msg"))==!0&&client.WOL("/",$(this).attr("mac"),function(a){a==200?alert(m.getString("wol_ok_msg")):alert(m.getString("wol_fail_msg"))});else{var a=$(this).attr("uid"),c=$(this).attr("uhref");g_storage.set("opentype",$(this).attr("type")=="usbdisk"?"1":"0");doPROPFIND(c,function(){g_storage.set("openhostuid",a);$("#hostview .host_item").each(function(){$(this).attr("uid")==
a?$(this).css("background-color","#009583"):$(this).css("background-color","#014051")})},null)}})}
function createThumbView(a,d,c,e){var b="";$("#main_right_container #fileview").empty();if(a!=2){a==0&&(b+='<div class="albumDiv">',b+='<table class="thumb-table-parent">',b+="<tbody>",b+="<tr><td>",b+='<div class="picDiv" isParent="1" popupmenu="0" uhref="',b+=d,b+='">',b+='<div class="parentDiv bicon"></div></div>',b+="</td></tr>",b+="<tr><td>",b+='<div class="albuminfo">',b+='<a id="list_item" qtype="1" isdir="1" uhref="',b+=d,b+='" title="'+m.getString("btn_prevpage")+'" online="0">'+m.getString("btn_prevpage"),
b+="</a>",b+="</div>",b+="</td></tr>",b+="</tbody>",b+="</table>",b+="</div>");for(d=0;d<c.length;d++)b+='<div class="albumDiv" ',b+=' title="',b+=c[d].name,b+='">',b+='<table class="thumb-table-parent">',b+="<tbody>",b+="<tr><td>",b+='<div class="picDiv" popupmenu="',b+=a=="0"?"1":"0",b+='" uhref="',b+=c[d].href,b+='">',b+=a=="2"?c[d].type=="usbdisk"?'<div id="fileviewicon" class="usbDiv bicon">':c[d].online=="1"?'<div id="fileviewicon" class="computerDiv bicon">':'<div id="fileviewicon" class="computerOffDiv bicon">':
'<div id="fileviewicon" class="folderDiv bicon">',b+='<div class="selectDiv sicon"></div>',b+='<div class="selectHintDiv sicon"></div>',b+="</div></div>",b+="</td></tr>",b+="<tr><td>",b+='<div class="albuminfo">',b+='<a id="list_item" qtype="',b+=a,b+='" isdir="1" uhref="',b+=c[d].href,b+='" title="',b+=c[d].name,b+='" online="',b+=c[d].online,b+='" ip="" mac="',b+=c[d].mac,b+='" uid="',b+=c[d].uid,b+='" freadonly="',b+=c[d].freadonly,b+='" fhidden="',b+=c[d].fhidden,b+=c[d].type=="usbdisk"?'" isusb="1"':
'" isusb="0"',b+='">',b+=c[d].shortname,c[d].online=="0"&&a=="2"&&(b+="("+m.getString("title_offline")+")"),b+="</a>",b+="</div>",b+="</td></tr>",b+="</tbody>",b+="</table>",b+="</div>";for(d=0;d<e.length;d++)b+='<div class="albumDiv"',b+=' title="',b+=e[d].name,b+='">',b+='<table class="thumb-table-parent">',b+="<tbody>",c=getFileExt(String(e[d].href)),c.length>5&&(c=""),b+="<tr><td>",b+=a=="0"?'<div class="picDiv" popupmenu="1" uhref="':'<div class="picDiv" popupmenu="0" uhref="',b+=e[d].href,b+=
'">',b+=c=="jpg"||c=="jpeg"||c=="png"||c=="gif"||c=="bmp"?'<div id="fileviewicon" class="imgfileDiv bicon">':c=="mp3"?'<div id="fileviewicon" class="audiofileDiv bicon">':c=="mp4"||c=="rmvb"||c=="m4v"||c=="wmv"||c=="avi"||c=="mpg"||c=="mpeg"||c=="mkv"||c=="mov"||c=="flv"?'<div id="fileviewicon" class="videofileDiv bicon">':'<div id="fileviewicon" class="fileDiv bicon">',b+='<div class="selectDiv sicon"></div>',b+='<div class="selectHintDiv sicon"></div>',b+="</div></div>",b+="</td></tr>",b+="<tr><td>",
b+='<div class="albuminfo" style="font-size:80%">',b+='<a id="list_item" qtype="1" isdir="0" uhref="',b+=e[d].href,b+='" title="',b+=e[d].name,b+='" uid="',b+=e[d].uid,b+='" ext="',b+=c,b+='" freadonly="',b+=e[d].freadonly,b+='" fhidden="',b+=e[d].fhidden,b+='">',b+=e[d].shortname,b+="</a>",b+="</div>",b+="</td></tr>",b+="</tbody>",b+="</table>",b+="</div>";$("#main_right_container #fileview").append(b);$(".picDiv").mousedown(onMouseDownPicDIVHandler)}}
function sortByName(a,d){var c=a.name.toLowerCase(),e=d.name.toLowerCase();return c<e?-1:c>e?1:0}function arraymove(a,d,c){var e=a[d];a.splice(d,1);a.splice(c,0,e)}function getPageSize(){var a=$(window).width(),d=$(window).height();return[a,d]}function showHideLoadStatus(a){a?$("#loading").css("display","block"):$("#loading").css("display","none")}
function onMouseDownPicDIVHandler(){if(g_select_mode==1)if($(this).attr("isParent")==1)cancelSelectMode(),openSelItem($(this).parents(".thumb-table-parent").find("a#list_item"));else{$(this).find(".selectDiv").css("display")=="none"?($(this).find(".selectDiv").css("display","block"),$(this).find(".selectHintDiv").css("display","none")):($(this).find(".selectDiv").css("display","none"),$(this).find(".selectHintDiv").css("display","block"));g_select_array=null;g_select_array=[];var a=0,d=0;$("#fileview").find(".albumDiv").each(function(){if($(this).find(".selectDiv").css("display")==
"block"){var c=$(this).find("#list_item").attr("uhref"),e=$(this).find("#list_item").attr("isdir"),b=$(this).find("#list_item").attr("title");e==1?d++:a++;g_select_array.push({isdir:e,uhref:c,title:b})}});a>=1?$("#btnDownload").removeClass("disable"):$("#btnDownload").addClass("disable");a>0?$("#btnShareLink").removeClass("disable"):$("#btnShareLink").addClass("disable");a>0||d>0?$("#btnDeleteSel").removeClass("disable"):$("#btnDeleteSel").addClass("disable");a+d==1?$("#btnRename").removeClass("disable"):
$("#btnRename").addClass("disable")}else openSelItem($(this).parents(".thumb-table-parent").find("a#list_item"))}function getInternetExplorerVersion(){var a=-1;navigator.appName=="Microsoft Internet Explorer"&&/MSIE ([0-9]{1,}[.0-9]{0,})/.exec(navigator.userAgent)!=null&&(a=parseFloat(RegExp.$1));return a}
function openSelItem(a){var d=a.attr("uhref"),c=a.attr("qtype"),e=a.attr("isdir"),b=a.attr("isusb"),f=a.attr("uhref"),g=a.attr("title");g_storage.set("openuid",a.attr("uid"));g_storage.set("opentype",b);if(c==2&&a.attr("online")==0)confirm(m.getString("wol_msg"))==!0&&(d=a.attr("mac"),client.WOL("/",d,function(a){a==200?alert(m.getString("wol_ok_msg")):alert(m.getString("wol_fail_msg"))}));else{var a=navigator.appVersion.toLowerCase(),n=navigator.userAgent.toLowerCase(),c=getFileExt(d),b=g_storage.get("webdav_mode");
if((b==0||b==2)&&a.indexOf("win")!=-1)if(c=="mp4"||c=="m4v"||c=="wmv"||c=="avi"||c=="rmvb"||c=="mpg"||c=="mpeg"||c=="mkv"||c=="mov"||c=="flv")if(n.indexOf("msie")!=-1&&getInternetExplorerVersion()<=8)alert(m.getString("msg_vlcsupport"));else{var i=$("div#modalWindow"),g=encodeURI(g);this_url=f.substring(0,f.lastIndexOf("/"));client.GSL(this_url,this_url,g,86400,0,function(a,c,b){a==200&&(a=$(b).find("sharelink").text(),c="",a=window.location.protocol+"//"+window.location.host+"/"+a,c="/smb/css/vlc_video.html?v="+
a,n.indexOf("msie")!=-1?window.open(c,"mywindow","status=no,toolbar=no,location=no,width=800,height=600"):(c+="&showbutton=1",g_modal_url=c,g_modal_window_width=655,g_modal_window_height=480,$("#jqmMsg").css("display","none"),$("#jqmTitleText").text(m.getString("title_videoplayer")),i&&i.jqmShow()))});return}c=="mp3"&&!(n.indexOf("msie")>-1||n.indexOf("firefox")>-1)?(i=$("div#modalWindow"),g_modal_url="/smb/css/audio.html?a="+d,g_modal_window_width=422,g_modal_window_height=120,$("#jqmMsg").css("display",
"none"),$("#jqmTitleText").text(m.getString("title_audioplayer")),i&&i.jqmShow()):e=="1"?doPROPFIND(d,null,null):window.open(d)}}
function createLayout(){var a=String(window.navigator.userLanguage||window.navigator.language).toLowerCase(),d=g_storage.get("lan")==void 0?a:g_storage.get("lan");m.setLanguage(d);a="";a+="<div id='header_region' class='unselectable' width='100%' border='0'>";a+="<div id='logo'></div>";a+="<div id='user'>Welcome home, <span id='username'>admin</span></div>";a+="<div id='loading'><img src='/smb/css/load.gif'/><div><span>Loading...</span></div></div>";a+="<div class='albutton toolbar-button-right' id='btnHelp'><div class='ticon'></div></div>";
a+="</div>";a+="<div id='main_region' class='unselectable'>";a+="<div id='main_left_region' class='unselectable'>";a+="<div id='infobar' class='unselectable'></div>";a+="<div id='hostview' class='unselectable'></div>";a+="<div id='settingbar' class='unselectable'>";a+="<div id='buttonpanel' class='unselectable'>";a+="<div class='toolbar-button-left' style='width:40px;height:40px;background-color:#FFC000'></div>";a+="<div class='toolbar-button-left' style='width:40px;height:40px;background-color:#0F4373'></div>";
a+="<div class='albutton toolbar-button-left' id='btnConfig' style='background-color:#578EA2'><div class='ticon'></div></div>";a+="<div class='toolbar-button-left' style='width:40px;height:40px;background-color:#008F6D'></div>";a+="<div class='albutton toolbar-button-left' id='btnSetting' style='background-color:#6A6A6A'><div class='ticon'></div></div>";a+="<div class='albutton toolbar-button-left' id='btnRefresh' style='background-color:#346948'><div class='ticon'></div></div>";a+="</div>";a+="</div>";
a+="</div>";a+="<div id='main_right_region' class='unselectable'>";a+="<div id='main_right_container' class='unselectable'>";a+="<div id='infobar' class='unselectable'>";a+="<div id='toolbar' class='unselectable'>";a+="<div id='urlregion-url'>";a+="<p id='openurl' align='left' width='150' style='padding-left:10px' ></p>";a+="</div>";a+="<div class='albutton toolbar-button-right' id='btnUpload' style='display:none'><div class='ticon'></div></div>";a+="<div class='albutton toolbar-button-right' id='btnNewDir' style='display:none'><div class='ticon'></div></div>";
a+="<div class='albutton toolbar-button-right' id='btnSelect' style='display:none'><div class='ticon'></div></div>";a+="<div class='albutton toolbar-button-right' id='btnCancelSelect' style='display:none'><div class='ticon'></div></div>";a+="<div class='albutton toolbar-button-right' id='btnCancelUpload' style='display:none'><div class='ticon'></div></div>";a+="<div class='albutton toolbar-button-right' id='btnChangeUser' style='display:none'><div class='ticon'></div></div>";a+="</div>";a+="</div>";
a+="<div id='fileview' class='unselectable'></div>";a+="<div id='button_panel' class='unselectable'>";a+="<div class='abbutton toolbar-button-right disable' id='btnShareLink' style='display:block'><div class='ticon'></div></div>";a+="<div class='abbutton toolbar-button-right disable' id='btnDeleteSel' style='display:block'><div class='ticon'></div></div>";a+="<div class='abbutton toolbar-button-right disable' id='btnDownload' style='display:block'><div class='ticon'></div></div>";a+="<div class='abbutton toolbar-button-right disable' id='btnRename' style='display:block'><div class='ticon'></div></div>";
a+="</div>";a+="<div id='upload_panel' class='unselectable'>";a+="<div style='position:absolute;width:98%;height:100%;padding:10px'>";a+="<iframe src='' width='100%' height='100%' frameborder='0'/>";a+="</div>";a+="</div>";a+="</div>";a+="</div>";a+="</div>";a+="<div id='bottom_region' class='unselectable'>";a+="<span id='function_help'></span>";a+="<div class='lan'>";a+="<span>"+m.getString("title_language")+"</span>";a+="<select id='menu_lan'>";a+="<option value='en' selected>"+m.getString("lan_en")+
"</option>";a+="<option value='zh-tw'>"+m.getString("lan_zh-tw")+"</option>";a+="</select>";a+="</div>";a+="</div>";a+="<div id='modalWindow' class='jqmWindow'>";a+="<div id='jqmTitle'>";a+="<span id='jqmTitleText'></span>";a+="</div>";a+="<div id='jqmMsg'>";a+="<span id='jqmMsgText'></span>";a+="</div>";a+="<iframe id='jqmContent' src='' frameborder='0'>";a+="</div>";$("body").empty();$("body").append(a);$("#menu_lan").children().each(function(){$(this).val()==d&&$(this).attr("selected","true")});
$("span#username").click(function(){confirm(m.getString("msg_logout_confirm"))==!0&&doLOGOUT()});$("#btnUpload").attr("title",m.getString("btn_upload"));$("#btnCancelUpload").attr("title",m.getString("btn_cancelupload"));$("#btnSelect").attr("title",m.getString("btn_select"));$("#btnCancelSelect").attr("title",m.getString("btn_cancelselect"));$("#btnNewDir").attr("title",m.getString("btn_newdir"));$("#btnShareLink").attr("title",m.getString("btn_sharelink"));$("#btnDeleteSel").attr("title",m.getString("btn_delselect"));
$("#btnDownload").attr("title",m.getString("func_download"));$("#btnRename").attr("title",m.getString("btn_rename"));$("#btnSetting").attr("title",m.getString("title_setting"));$("#btnRefresh").attr("title",m.getString("btn_refresh"))}
$(document).ready(function(){function a(c){c&&c[0]!=2&&alert(m.getString(c)+": "+g_selected_files[0]);g_selected_files.splice(0,1);g_selected_files.length<=0?(c=addPathSlash(g_storage.get("openurl")),doPROPFIND(c)):client.DELETE(g_selected_files[0],a)}document.onmousedown=function(){resetTimer()};document.onmousemove=function(){resetTimer()};$(document).keydown(function(a){a.keyCode==27&&(g_select_mode==1?cancelSelectMode():g_upload_mode==1&&closeUploadPanel(),closeJqmWindow())});g_storage.set("stopLogoutTimer",
"0");g_storage.set("isOpenModalWindow","0");createLayout();showHideLoadStatus(!1);adjustLayout();(function(){client.GETROUTERINFO("/",function(a,d,b){a==200&&(a=$(b),g_storage.set("webdav_mode",a.find("webdav_mode").text()),g_storage.set("http_port",a.find("http_port").text()),g_storage.set("https_port",a.find("https_port").text()),g_storage.set("misc_http_enable",a.find("misc_http_enable").text()),g_storage.set("misc_http_port",a.find("misc_http_port").text()))})})();var d=g_storage.get("openurl");
g_storage.set("HostList","");doPROPFIND("/",function(){d!=void 0&&d!="/"&&doPROPFIND(d);if(g_storage.get("openhostuid")==void 0){var a="<div id='help_1'>";a+="<div id='help_content'>";a+=m.getString("msg_help");a+="</div>";a+="<div id='help_image'>";a+="</div>";a+="</div>";$("div#fileview").append(a)}},0);$("#modalWindow").jqm({overlay:70,modal:!0,target:"#jqmContent",onHide:function(a){$(a.w).fadeOut("2000",function(){a.o.remove();g_show_modal=0;if(g_reload_page==1){var d=addPathSlash(g_storage.get("openurl"));
doPROPFIND(d)}})},onShow:function(a){var a=$(a.w),d=$("iframe",a),b=($(document).width()-g_modal_window_width)/2;g_show_modal=1;d.attr("src",g_modal_url);a.css({width:g_modal_window_width,height:g_modal_window_height,left:b,top:-g_modal_window_height,opacity:0}).jqmShow().animate({width:g_modal_window_width,height:g_modal_window_height,top:0,left:b,marginLeft:0,opacity:1},200)}});$("div#btnDeleteSel").click(function(){if(!(g_select_array.length<=0)&&confirm(m.getString("del_files_msg"))==!0){g_selected_files=
null;g_selected_files=[];for(var c=0;c<g_select_array.length;c++)g_selected_files.push(g_select_array[c].uhref);client.DELETE(g_selected_files[0],a)}});$("div#btnNewDir").click(function(){var a=$("div#modalWindow");g_modal_url="/smb/css/makedir.html";g_modal_window_width=500;g_modal_window_height=100;$("#jqmMsg").css("display","none");$("#jqmTitleText").text(m.getString("title_newdir"));a&&a.jqmShow()});$("div#btnRefresh").click(function(){var a=g_storage.get("openurl");g_storage.set("HostList","");
doPROPFIND("/",function(){a=a==void 0?"/":a;a!="/"&&doPROPFIND(a)},0)});$("div#btnSetting").click(function(){var a=$("div#modalWindow");g_modal_url="/smb/css/setting.html";g_modal_window_width=600;g_modal_window_height=400;$("#jqmMsg").css("display","none");$("#jqmTitleText").text(m.getString("title_setting"));a&&a.jqmShow()});$("div#btnShareLink").click(function(){if(!(g_select_array.length<=0)){m.getString("email_subject");for(var a="",d="",b="",f=0;f<g_select_array.length;f++){var g=g_select_array[f].title,
n=g_select_array[f].uhref,i=window.location.href;g_select_array[f].isdir!=1&&(g=encodeURI(g),d=i=n.substring(0,n.lastIndexOf("/")),b+=g,b+=";")}var f=g_storage.get("webdav_mode"),l=window.location.host;l.indexOf(":")!=-1&&(l=l.substring(0,l.indexOf(":")));l=f==0?"http://"+l+":"+g_storage.get("http_port"):"https://"+l;client.GSL(d,d,b,86400,1,function(b,d,e){if(b==200){b=$(e).find("sharelink").text().split(";");d=b.length;for(e=0;e<d;e++)a+=l+"/"+b[e],e!=d-1&&(a+="<br><br>");b=$("div#modalWindow");
g_modal_url="/smb/css/sharelink.html?v="+a;g_modal_window_width=600;g_modal_window_height=500;$("#jqmMsg").css("display","none");$("#jqmTitleText").text(m.getString("title_sharelink"));b&&b.jqmShow()}})}});$("div#btnDownload").click(function(){if(!(g_select_array.length<=0))for(var a=0;a<g_select_array.length;a++){var d=g_select_array[a].title,b=g_select_array[a].uhref,f=window.location.href;g_select_array[a].isdir!=1&&(d=encodeURI(d),f=b.substring(0,b.lastIndexOf("/")),window.open(f+"/"+d))}});$("div#btnRename").click(function(){if(g_select_array.length==
1){var a=g_select_array[0].title,d=g_select_array[0].uhref,b=g_select_array[0].isdir,f=$("div#modalWindow");g_modal_url="/smb/css/rename.html?o="+a+"&f="+d+"&d="+b;g_modal_window_width=500;g_modal_window_height=100;$("#jqmMsg").css("display","none");$("#jqmTitleText").text(m.getString("title_rename"));f&&f.jqmShow()}});$("div#btnChangeUser").click(function(){var a=g_storage.get("openurl");client.LOGOUT(a,function(d){d==200&&doPROPFIND(a)})});$("div#btnSelect").click(function(){g_select_mode=1;$("div#btnNewDir").css("display",
"none");$("div#btnUpload").css("display","none");$("div#btnSelect").css("display","none");var a=$("div#btnNewDir").width()+$("div#btnUpload").width()+5;$("div#btnCancelSelect").css("display","block");$("div#btnCancelSelect").css("right",a);$("div#btnCancelSelect").animate({right:5},500,function(){$(".selectHintDiv").css("display","block");$("#fileview #fileviewicon").each(function(){$(this).addClass("select")});adjustLayout();$("#button_panel").css("left","1999px");$("#button_panel").css("display",
"block");$("#button_panel").animate({left:"0px"},"slow",null,function(){$("#function_help").text(m.getString("msg_selectmode_help"))})})});$("div#btnSelect2").click(function(){g_select_mode=1;$(".selectHintDiv").css("display","block");$("div#btnNewDir").css("display","none");$("div#btnUpload").css("display","none");$("div#btnSelect").css("display","none");$("div#btnCancelSelect").css("display","block");$("#fileview #fileviewicon").each(function(){$(this).addClass("select")});adjustLayout();$("#button_panel").css("left",
"1999px");$("#button_panel").css("display","block");$("#button_panel").animate({left:"0px"},"slow",null,function(){$("#function_help").text(m.getString("msg_selectmode_help"))})});$("div#btnCancelSelect").click(function(){$("div#btnCancelSelect").css("display","none");$("div#btnSelect").css("display","block");$("div#btnSelect").css("right",5);$("div#btnSelect").animate({right:85},500,function(){cancelSelectMode();$("div#btnSelect").css("right",5)})});$("#btnUpload").click(function(){g_upload_mode=
1;$("div#btnNewDir").css("display","none");$("div#btnUpload").css("display","none");$("div#btnSelect").css("display","none");$("div#btnCancelUpload").css("display","block");$("#upload_panel").css("display","block");$("#upload_panel").css("left","1999px");$("#upload_panel").animate({left:"0px"},"slow");var a=addPathSlash(g_storage.get("openurl"));$("#upload_panel iframe").attr("src","/smb/css/upload.html?u="+a);$("#function_help").text(m.getString("msg_uploadmode_help"));adjustLayout()});$("#btnCancelUpload").click(closeUploadPanel);
$("a.logout").click(doLOGOUT);$("div#hostview").scroll(function(){g_storage.set("hostviewscrollTop",$(this).scrollTop())});$("div#fileview").scroll(function(){g_storage.set("contentscrollLeft",$(this).scrollLeft());g_storage.set("contentscrollTop",$(this).scrollTop())});$("#menu_lan").change(function(){var a=$(this).val();g_storage.set("lan",a);window.location.reload()});$("#btnHelp").click(function(){var a=$("div#modalWindow");g_modal_url="/smb/css/help.html?showbutton=1";g_modal_window_width=960;
g_modal_window_height=750;$("#jqmMsg").css("display","none");$("#jqmTitleText").text(m.getString("title_help"));a&&a.jqmShow()});$("#btnConfig").click(function(){var a=g_storage.get("misc_http_enable"),d=g_storage.get("misc_http_port"),b=window.location.host;a==0&&b.indexOf("192.168")!=0?alert(m.getString("msg_no_config")):(a=b.indexOf("192.168")==0?"http://"+b.split(":")[0]:"http://"+b.split(":")[0]+":"+d,window.location=a)});$(window).resize(adjustLayout)});
