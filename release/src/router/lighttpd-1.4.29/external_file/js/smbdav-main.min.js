var g_support_html5=0,g_reload_page=1,g_popupmenu,g_samba_popupmenu,g_show_tree="show",m=new lang,g_storage=new myStorage,g_listview=g_storage.get("listview")==void 0?0:g_storage.get("listview"),treelist=new storageList("MyTree"),g_modal_url,g_modal_window_width=200,g_modal_window_height=100,timer_idle,g_show_modal=0,g_time_out=9E5,client=new davlib.DavClient;client.initialize();g_support_html5=window.File&&window.FileReader&&window.FileList&&window.Blob?1:0;
function getUrlVars(){for(var a=[],f,e=window.location.href.slice(window.location.href.indexOf("?")+1).split("&"),c=0;c<e.length;c++)f=e[c].split("="),a.push(f[0]),a[f[0]]=f[1];return a}function getFileExt(a){a=/^.+\.([^.]+)$/.exec(a);return a==null?"":a[1].toLowerCase()}function addPathSlash(a){if(a.lastIndexOf("/")==a.length-1)return a;a+="/";return a}function size_format(a){for(var f=0;a>=1024;)a/=1024,++f;return a.toFixed(1)+" "+["B","KB","MB","GB","TB","PB","EB","ZB","YB"][f]}
function mydecodeURI(a){a=decodeURI(a);a=String(a).replace("%22",'"');a=String(a).replace("%23","#");a=String(a).replace("%24","$");a=String(a).replace("%25","%");a=String(a).replace("%26","&");a=String(a).replace("%2b","+");return a=String(a).replace("%40","@")}
function myencodeURI(a){a=String(a).replace("%","%25");a=String(a).replace('"',"%22");a=String(a).replace("#","%23");a=String(a).replace("$","%24");a=String(a).replace("&","%26");a=String(a).replace("+","%2b");a=String(a).replace("@","%40");return a=encodeURI(a)}function doRescanSamba(){var a=addPathSlash(g_storage.get("openurl"));closeJqmWindow(0);showHideLoadStatus(!0);client.RESCANSMBPC(a,function(a){a[0]==2&&doPROPFIND("/")})}
function doMKDIR(a){var f=addPathSlash(g_storage.get("openurl")),e=f+myencodeURI(a),c=0;$("a#list_item").each(function(){$(this).attr("isdir")=="1"&&a==$(this).attr("title")&&(c=1,alert(m.getString("folder_already_exist_msg")))});c!=1&&client.MKCOL(e,function(a){a[0]==2?(doPROPFIND(f),closeJqmWindow(0)):alert(m.getString(a))})}
function doRENAME(a,f){var e=0,c=addPathSlash(g_storage.get("openurl")),g=c+encodeURI(f);$("a#list_item").each(function(){$(this).attr("isdir")=="1"&&f==$(this).attr("title")&&(e=1,alert(m.getString("folder_already_exist_msg")))});e!=1&&client.MOVE(a,g,function(a){a[0]==2?(doPROPFIND(c),closeJqmWindow(0)):alert(m.getString(a))})}function closeJqmWindow(a){g_reload_page=a;(a=$("div#modalWindow"))&&a.jqmHide()}
function fullscreenJqmWindow(){var a=$("div#modalWindow");a&&(a.css("left","0px"),a.css("top","0px"),a.css("width",window.width+"px"),a.css("height",window.height+"px"))}function doLOGOUT(){g_storage.get("onUploading")!="1"&&doPROPFIND("/",function(){addPathSlash(g_storage.get("openurl"));client.LOGOUT("/",function(a){if(a[0]==2)window.location="/smb/css/logout.html"})},0)}function doLOGIN(a,f){doPROPFIND(a,function(){closeJqmWindow(0)},f)}
function resetTimer(){clearInterval(timer_idle);timer_idle=setInterval(doLOGOUT,g_time_out)}
function doPROPFIND(a,f,e){client!=null&&(showHideLoadStatus(!0),client.PROPFIND(a,e,function(c,g,e){if(c){if(c==207){try{var o,k,c=[],g=[];if(window.DOMParser)o=new DOMParser,k=o.parseFromString(e,"text/xml");else if(k=new ActiveXObject("Microsoft.XMLDOM"),k.async="false",k.loadXML(e),!k.documentElement){alert("Fail to load xml!");showHideLoadStatus(!1);return}var d,l,v,i,p,K=k.documentElement.childNodes,h=k.documentElement.getAttribute("qtype"),M=k.documentElement.getAttribute("readonly"),N=k.documentElement.getAttribute("ruser"),
L=k.documentElement.getAttribute("computername");for(d=0;d<K.length;d++){var q=k=o=e="",t="",A="",B="",C="",D="",E="",F="",G="",H="",I,r=K[d].childNodes;for(l=0;l<r.length;l++)if(r[l].nodeType==1&&r[l].nodeName=="D:propstat"){var J=r[l].childNodes;for(v=0;v<J.length;v++)if(J[v].nodeName=="D:prop"){var j=J[v].childNodes;for(i=0;i<j.length;i++)if(!(j[i].childNodes.length<=0))if(j[i].nodeName=="D:getcontenttype")o=String(j[i].childNodes[0].nodeValue);else if(j[i].nodeName=="D:getuniqueid")k=String(j[i].childNodes[0].nodeValue);
else if(j[i].nodeName=="D:getonline")A=String(j[i].childNodes[0].nodeValue);else if(j[i].nodeName=="D:getlastmodified")B=String(j[i].childNodes[0].nodeValue);else if(j[i].nodeName=="D:getcontentlength")C=String(size_format(parseInt(j[i].childNodes[0].nodeValue)));else if(j[i].nodeName=="D:getmac")E=String(j[i].childNodes[0].nodeValue);else if(j[i].nodeName=="D:getip")D=String(j[i].childNodes[0].nodeValue);else if(j[i].nodeName=="D:gettype")F=String(j[i].childNodes[0].nodeValue);else if(j[i].nodeName==
"D:getattr"){var w=j[i].childNodes;for(p=0;p<w.length;p++)if(w[p].nodeName=="D:readonly")G=w[p].childNodes[0].nodeValue;else if(w[p].nodeName=="D:hidden")H=w[p].childNodes[0].nodeValue}}}else if(r[l].nodeType==1&&r[l].nodeName=="D:href"){var e=String(r[l].childNodes[0].nodeValue),u="";e.match(/^http/)&&(u=window.location.protocol+"//"+window.location.host);var O=u+addPathSlash(a);if(e!=O){var P=a,e=e.replace(u,""),q=e.replace(addPathSlash(P),"");q!=""?(I=q,t=q=mydecodeURI(q),u=g_listview==0?12:45,
t.length>u&&(t=t.substring(0,u)+"...")):e=""}else e=""}e!=""&&(o=="httpd/unix-directory"?c.push({contenttype:o,href:e,name:q,uname:I,shortname:t,online:A,time:B,size:C,ip:D,mac:E,uid:k,type:F,freadonly:G,fhidden:H}):g.push({contenttype:o,href:e,name:q,uname:I,shortname:t,online:A,time:B,size:C,ip:D,mac:E,uid:k,type:F,freadonly:G,fhidden:H}))}var n=addPathSlash(a);n!="/"&&(n=n.substring(0,n.length-1),n=n.substring(0,n.lastIndexOf("/")),n==""&&(n="/"));c.sort(sortByName);g.sort(sortByName);var x;for(x=
0;x<c.length;x++)if(c[x].type=="usbdisk"){arraymove(c,x,0);break}var s=g_storage.get("openuid"),s=s==void 0?0:s;treelist.removeByPID(s);for(d=0;d<c.length;d++)if(!treelist.isUIDExists(c[d].uid)){var Q=c[d].uname;c[d].online==0&&s==0&&treelist.removeByPID(c[d].uid);var b=Q+"|"+s+"|"+c[d].uid+"|"+c[d].online+"|"+c[d].mac+"|"+c[d].type+"|"+c[d].ip;treelist.add(b)}createTree(L,treelist.items(),null,s,onTreeItemClickHandler);b="";if(g_listview==1){b+='<table id="ntb" pagenum="0" maxrows="13" flock="" field="time" fval="" order="DESC" totalpages="84" keyword="" class="sortable" width="100%">';
b+='<thead class="category">';b+="<tr>";b+='<td class="check" style="width:25px;">';h=="0"&&(b+='<input type="checkbox" id="c1_all">');b+="</td>";b+='<td class="icon">&nbsp;</td>';b+='<th class="name" popupmenu="0" style="width:350px;">'+m.getString("table_filename")+"</th>";h=="0"&&(b+='<td class="size">'+m.getString("table_size")+"</td>",b+='<td class="time">'+m.getString("table_time")+"</td>");b+='<td class="type">'+m.getString("table_type")+"</td>";b+="</tr>";b+="</thead>";h!="2"&&(b+="<tbody>",
b+='<tr class="content">',b+='<td class="check"><input type="checkbox" id="c2" style="visibility:hidden"></td>',b+='<td class="icon"><div class="sfolderDiv sicon"></div>',b+='<th class="name" popupmenu="0"><div id="div_item">',b+='<a id="list_item" qtype="',b+=h,b+='" online="1"',b+=' isdir="1" uhref="',b+=n,b+='" title=".."',b+='">..</a></div></th>',h=="0"&&(b+='<td class="size">',b+="</td>",b+='<td class="time">',b+="</td>"),b+='<td class="type">',b+="Folder",b+="</td>",b+="</tr></tbody>");for(d=
0;d<c.length;d++)b+="<tbody>",b+='<tr class="content">',b+=h=="0"?'<td class="check"><input type="checkbox" id="c1"></td>':'<td class="check"><input type="checkbox" id="c2" style="visibility:hidden"></td>',b+=h=="2"?c[d].type=="usbdisk"?'<td class="icon"><div class="susbDiv sicon"></div>':c[d].online=="1"?'<td class="icon"><div class="scomputerDiv sicon"></div>':'<td class="icon"><div class="scomputerOffDiv sicon"></div>':'<td class="icon"><div class="sfolderDiv sicon"></div>',b+=h=="0"?'<th class="name" popupmenu="1"><div id="div_item">':
'<th class="name" popupmenu="0"><div id="div_item">',b+='<a id="list_item" qtype="',b+=h,b+='" online="',b+=c[d].online,b+='" isdir="1" uhref="',b+=c[d].href,b+='" title="',b+=c[d].name,b+='" ip="" mac="',b+=c[d].mac,b+='" uid="',b+=c[d].uid,b+='" freadonly="',b+=c[d].freadonly,b+='" fhidden="',b+=c[d].fhidden,b+=c[d].type=="usbdisk"?'" isusb="1"':'" isusb="0"',b+='">',b+=c[d].shortname,c[d].online=="0"&&h=="2"&&(b+="("+m.getString("title_offline")+")"),b+="</a>",b+="</div></th>",h=="0"&&(b+='<td class="size">',
b+="</td>",b+='<td class="time">',b+="</td>"),b+='<td class="type">',b+=h=="2"?"Computer":"Folder",b+="</td>",b+="</tr></tbody>";for(d=0;d<g.length;d++)b+="<tbody>",b+='<tr class="content">',b+=h=="0"?'<td class="check"><input type="checkbox" id="c1"></td>':'<td class="check"><input type="checkbox" id="c2" style="visibility:hidden"></td>',b+='<td class="icon"><div class="sfileDiv sicon"></div></td>',b+='<th class="name" popupmenu="1"><div id="div_item">',b+='<a id="list_item" qtype="0" isdir="0" uhref="',
b+=g[d].href,b+='" title="',b+=g[d].name,b+='" uid="',b+=g[d].uid,b+='" freadonly="',b+=g[d].freadonly,b+='" fhidden="',b+=g[d].fhidden,b+='">',b+=g[d].shortname,b+="</a>",b+="</div>",b+="</th>",h=="0"&&(b+='<td class="size">',b+=g[d].size,b+="</td>",b+='<td class="time">',b+=g[d].time,b+="</td>"),b+='<td class="type">',b+="File",b+="</td>",b+="</tr></tbody>";b+="</table>";b+="</div>"}else{h!="2"&&(b+='<div class="albumDiv">',b+='<table class="thumb-table-parent">',b+="<tbody>",b+='<tr><td class="thumb-check-area"></td></tr>',
b+="<tr><td>",b+='<div class="picDiv" popupmenu="0" uhref="',b+=n,b+='">',b+='<div class="folderDiv bicon"></div></div>',b+="</td></tr>",b+="<tr><td>",b+='<div class="albuminfo">',b+='<a id="list_item" qtype="1" isdir="1" uhref="',b+=n,b+='" title=".." online="0">..',b+="</a>",b+="</div>",b+="</td></tr>",b+="</tbody>",b+="</table>",b+="</div>");for(d=0;d<c.length;d++)b+='<div class="albumDiv" ',b+=' title="',b+=c[d].name,b+='">',b+='<table class="thumb-table-parent">',b+="<tbody>",h=="0"?(b+='<tr class="thumb-top-option"><td class="thumb-check-area">',
b+='<input type="checkbox" id="c1"></td></tr>'):b+='<tr><td class="thumb-check-area"></td></tr>',b+="<tr><td>",b+='<div class="picDiv" popupmenu="',b+=h=="0"?"1":"0",b+='" uhref="',b+=c[d].href,b+='">',b+=h=="2"?c[d].type=="usbdisk"?'<div class="usbDiv bicon"></div></div>':c[d].online=="1"?'<div class="computerDiv bicon"></div></div>':'<div class="computerOffDiv bicon"></div></div>':'<div class="folderDiv bicon"></div></div>',b+="</td></tr>",b+="<tr><td>",b+='<div class="albuminfo">',b+='<a id="list_item" qtype="',
b+=h,b+='" isdir="1" uhref="',b+=c[d].href,b+='" title="',b+=c[d].name,b+='" online="',b+=c[d].online,b+='" ip="" mac="',b+=c[d].mac,b+='" uid="',b+=c[d].uid,b+='" freadonly="',b+=c[d].freadonly,b+='" fhidden="',b+=c[d].fhidden,b+=c[d].type=="usbdisk"?'" isusb="1"':'" isusb="0"',b+='">',b+=c[d].shortname,c[d].online=="0"&&h=="2"&&(b+="("+m.getString("title_offline")+")"),b+="</a>",b+="</div>",b+="</td></tr>",b+="</tbody>",b+="</table>",b+="</div>";for(d=0;d<g.length;d++){b+='<div class="albumDiv"';
b+=' title="';b+=g[d].name;b+='">';b+='<table class="thumb-table-parent">';b+="<tbody>";h=="0"?(b+='<tr class="thumb-top-option"><td class="thumb-check-area">',b+='<input type="checkbox" id="c1"></td></tr>'):b+='<tr><td class="thumb-check-area"></td></tr>';var z=getFileExt(String(g[d].href));z.length>5&&(z="");b+="<tr><td>";b+=h=="0"?'<div class="picDiv" popupmenu="1" uhref="':'<div class="picDiv" popupmenu="0" uhref="';b+=g[d].href;b+='">';b+='<div class="fileDiv bicon">';b+="<span>"+z+"</span>";
b+="</div></div>";b+="</td></tr>";b+="<tr><td>";b+='<div class="albuminfo" style="font-size:80%">';b+='<a id="list_item" qtype="1" isdir="0" uhref="';b+=g[d].href;b+='" title="';b+=g[d].name;b+='" uid="';b+=g[d].uid;b+='" ext="';b+=z;b+='" freadonly="';b+=g[d].freadonly;b+='" fhidden="';b+=g[d].fhidden;b+='">';b+=g[d].shortname;b+="</a>";b+="</div>";b+="</td></tr>";b+="</tbody>";b+="</table>";b+="</div>"}}document.getElementById("div_table_content").innerHTML=b;$("th.name").mousedown(onMouseDownTableNameHandler);
$(".picDiv").mousedown(onMouseDownPicDIVHandler);g_storage.set("openurl",a);$("#homepage").css("display","block");$("#btnRefresh").css("display","block");$("#btnDeleteSel").css("display","none");$("#btnShareLink").css("display","none");$("#btnRename").css("display","none");$("#btnNewDir").css("display","none");$("#btnUpload").css("display","none");$("#prevpage").css("display","none");$("#btnChangeUser").css("display","none");h=="0"?($("#prevpage").css("display","block"),M=="0"&&($("#btnNewDir").css("display",
"block"),$("#btnUpload").css("display","block"),g_support_html5==0?$("#btnUpload").css("display","none"):$("#btnUpload").attr("disabled",""))):h=="1"&&($("#prevpage").css("display","block"),g_storage.get("opentype")=="0"&&$("#btnChangeUser").css("display","block"));g_listview==1?($("#thumbview").css("display","block"),$("#listview").css("display","none")):($("#thumbview").css("display","none"),$("#listview").css("display","block"));$("input[id=c1]").change(function(){var b=0,a=0,g=0;$("input:checkbox[id=c1]").each(function(){var d,
c;d=g_listview==1?$(this).parents("tr.content").find("a#list_item"):$(this).parents(".albumDiv").find("a#list_item");c=d.attr("freadonly");d=d.attr("isdir");$(this).is(":checked")==!0?(d==0&&(b=1),c=="false"&&$("#btnDeleteSel").css("display","block"),g++,g_listview==1?$(this).parents("tr.content").css("background-color","#FFBF4F"):$(this).parents(".albumDiv").css("background-color","#FFBF4F")):g_listview==1?$(this).parents("tr.content").css("background-color","#FFFFFF"):$(this).parents(".albumDiv").css("background-color",
"#FFFFFF");a++});b==1?$("#btnShareLink").css("display","block"):$("#btnShareLink").css("display","none");$("#btnRename").css("display","block");g>1?($("#btnRename").attr("disabled","disabled"),$("#btnRename").addClass("disable")):($("#btnRename").attr("disabled",""),$("#btnRename").removeClass("disable"))});$("input[id=c1_all]").change(function(){$("input[id=c1_all]").is(":checked")==!0?($("input[id=c1]").attr("checked","checked"),$("#btnDeleteSel").css("display","block"),$("#btnShareLink").css("display",
"block"),g_listview==1&&$("input[id=c1]").parents("tr.content").css("background-color","#FFBF4F")):($("input[id=c1]").attr("checked",""),$("#btnDeleteSel").css("display","none"),$("#btnShareLink").css("display","none"),g_listview==1&&$("input[id=c1]").parents("tr.content").css("background-color","#FFFFFF"))});$(".albumDiv").mouseover(function(){$(this).find("input[id=c1]").is(":checked")==!1&&$(this).css("background-color","#B9E3EA")});$(".albumDiv").mouseleave(function(){$(this).find("input[id=c1]").is(":checked")==
!1&&$(this).css("background-color","#FFFFFF")});b=mydecodeURI(a);if(b!="/")for(;b.indexOf("/")!=-1;)b=b.replace("/"," \u300b");else b="";$("#treeBanner #routername").text(L);$("p#openurl").text(m.getString("title_openurl")+b);$("span.prompt cite").text(N);$("div#div_table_content").scrollLeft(g_storage.get("contentscrollLeft"));$("div#div_table_content").scrollTop(g_storage.get("contentscrollTop"))}catch(R){alert("catch error: "+R)}f!=void 0&&f()}else c==501?doPROPFIND(a):c==401?(d=$("div#modalWindow"),
l=d.css("display"),g_modal_url="/smb/css/login.html?v="+a,g_modal_window_width=365,g_modal_window_height=150,$("#jqmTitleText").text(m.getString("title_login")+" - "+a),l=="block"&&$("#jqmMsgText").text(m.getString("msg_passerror")),$("#jqmMsg").css("display",l),d&&d.jqmShow()):alert(m.getString(c));showHideLoadStatus(!1)}},null,1),resetTimer())}function sortByName(a,f){var e=a.name.toLowerCase(),c=f.name.toLowerCase();return e<c?-1:e>c?1:0}
function arraymove(a,f,e){var c=a[f];a.splice(f,1);a.splice(e,0,c)}function getPageSize(){var a=$(window).width(),f=$(window).height();$("#headerRegion").height();$("#bottomRegion").height();$("#div_table_content").height();$("#treeInfoRegion").height();$("#tree").height();return[a,f]}
function showHideLoadStatus(a){getPageSize();a?$("#loading").css("display","block"):$("#loading").css("display","none");$("#loading").css("top",$("#headerRegion").height());$("#loading").css("height",$("#mainRegion").height())}
function onTreeItemClickHandler(a,f,e,c,g,y){a!=void 0&&(e==0&&c==0?confirm(m.getString("wol_msg"))==!0&&client.WOL("/",g,function(a){a==200?alert(m.getString("wol_ok_msg")):alert(m.getString("wol_fail_msg"))}):(g_storage.set("openuid",f),g_storage.set("opentype",y=="usbdisk"?"1":"0"),doPROPFIND(a,null,null)))}function onMouseDownTableNameHandler(a){if(a.button==2)return $(this).attr("popupmenu")==1&&g_popupmenu.bind($(this).find("a#list_item"),a),!1;openSelItem($(this).find("a#list_item"))}
function onMouseDownPicDIVHandler(a){if(a.button==2)return $(this).attr("popupmenu")==1&&g_popupmenu.bind($(this).parents(".thumb-table-parent").find("a#list_item"),a),!1;openSelItem($(this).parents(".thumb-table-parent").find("a#list_item"))}function getInternetExplorerVersion(){var a=-1;navigator.appName=="Microsoft Internet Explorer"&&/MSIE ([0-9]{1,}[.0-9]{0,})/.exec(navigator.userAgent)!=null&&(a=parseFloat(RegExp.$1));return a}
function openSelItem(a){var f=a.attr("uhref"),e=a.attr("qtype"),c=a.attr("isdir"),g=a.attr("isusb"),y=a.attr("uhref"),o=a.attr("title");g_storage.set("openuid",a.attr("uid"));g_storage.set("opentype",g);if(e==2&&a.attr("online")==0)confirm(m.getString("wol_msg"))==!0&&(f=a.attr("mac"),client.WOL("/",f,function(a){a==200?alert(m.getString("wol_ok_msg")):alert(m.getString("wol_fail_msg"))}));else{a=navigator.appVersion.toLowerCase();e=navigator.userAgent.toLowerCase();g=getFileExt(f);if(window.location.protocol==
"http:"&&a.indexOf("win")!=-1&&(g=="mp4"||g=="m4v"||g=="wmv"||g=="avi"||g=="rmvb"||g=="mpg"||g=="mpeg"||g=="mkv"||g=="mov"||g=="flv"))if(e.indexOf("msie")!=-1&&getInternetExplorerVersion()<=8)alert(m.getString("msg_vlcsupport"));else{c=$("div#modalWindow");o=encodeURI(o);this_url=y.substring(0,y.lastIndexOf("/"));client.GSL(this_url,this_url,o,86400,0,function(a,g,c){a==200&&(a=$(c).find("sharelink").text(),g="",a=window.location.protocol+"//"+window.location.host+"/"+a,window.open("/smb/css/vlc_video.html?v="+
a,"mywindow","status=no,toolbar=no,location=no,width=800,height=600"))});return}g=="mp3"&&!(e.indexOf("msie")>-1||e.indexOf("firefox")>-1)?(c=$("div#modalWindow"),g_modal_url="/smb/css/audio.html?a="+f,g_modal_window_width=422,g_modal_window_height=120,$("#jqmMsg").css("display","none"),$("#jqmTitleText").text(m.getString("title_audioplayer")),c&&c.jqmShow()):c=="1"?doPROPFIND(f,null,null):window.open(f)}}
function initSambaPopupmenu(){g_samba_popupmenu=new PopupMenu;g_samba_popupmenu.add("changeuser",m.getString("func_changeuser"),function(){})}
function initPopupmenu(){g_popupmenu=new PopupMenu;g_popupmenu.add("delete",m.getString("func_delete"),function(a){var f=a.attr("title"),a=a.attr("uhref");confirm(m.getString("del_file_msg")+"[ "+f+" ]")==!0&&client.DELETE(a,function(a){a&&(a[0]==2?(a=addPathSlash(g_storage.get("openurl")),doPROPFIND(a)):alert(m.getString(a)))})});g_popupmenu.add("rename",m.getString("func_rename"),function(a){var f=a.attr("title"),e=a.attr("uhref"),a=a.attr("isdir"),c=$("div#modalWindow");g_modal_url="/smb/css/rename.html?o="+
f+"&f="+e+"&d="+a;g_modal_window_width=500;g_modal_window_height=100;$("#jqmMsg").css("display","none");$("#jqmTitleText").text(m.getString("title_rename"));c&&c.jqmShow()});g_popupmenu.addSeparator();g_popupmenu.add("email",m.getString("func_email"),function(a){var f=a.attr("title"),e=a.attr("uhref"),a=a.attr("isdir"),c=window.location.href;a!=1&&(f=encodeURI(f),c=e.substring(0,e.lastIndexOf("/")),client.GSL(c,c,f,86400,1,function(a,c,e){a==200?(a=$(e).find("sharelink").text(),c=window.location.host,
c=c.substring(0,c.indexOf(":")),a="https://"+c+"/"+a,c=$("div#modalWindow"),g_modal_url="/smb/css/sharelink.html?v="+a,g_modal_window_width=600,g_modal_window_height=500,$("#jqmMsg").css("display","none"),$("#jqmTitleText").text(m.getString("title_sharelink")),c&&c.jqmShow()):alert(m.getString(a))}))});g_popupmenu.add("download",m.getString("func_download"),function(a){var f=a.attr("title"),e=a.attr("uhref"),a=a.attr("isdir"),c=window.location.href;a!=1&&(f=encodeURI(f),c=e.substring(0,e.lastIndexOf("/")),
window.open(c+"/"+f))});g_popupmenu.setSize(140,0)}
$(document).ready(function(){function a(){var a=getPageSize(),c=a[1]-$(".ocButton").height()-$("#footerRegion").height()-110,e=10;g_show_tree=="show"?($("#treeRegion").css("width","160px"),$("#treeRegion").css("border-width","10px"),$("#tree").css("display","block"),$(".ocButton").removeClass("close"),$(".ocButton").addClass("open"),$(".ocButton").css("left","170px"),$(".ocButton").css("top",c+"px"),e=10,$("#mainRegion").css("min-width","514px")):($("#treeRegion").css("width","0px"),$("#treeRegion").css("border-width",
"0"),$("#tree").css("display","none"),$(".ocButton").addClass("close"),$(".ocButton").removeClass("open"),$(".ocButton").css("left","0px"),$(".ocButton").css("top",c+"px"),e=0,$("#mainRegion").css("min-width","695px"));var c=a[1]-$("#headerRegion").height()-$("#footerRegion").height(),f=c-$("#bottomRegion").height()-$("#urlRegion").height(),d=c-2*e;$("#treeRegion").css("height",d+"px");d=c-$("#treeBanner").height()-10;$("#treeRegion #tree").css("height",d+"px");a=a[0]-$("#treeRegion").width()-2*e-
1;$("#mainRegion").css("width",a+"px");$("#mainRegion").css("height",c+"px");$("#div_table_content").css("height",f+"px")}function f(a){a&&a[0]!=2&&alert(m.getString(a)+": "+g_selected_files[0]);g_selected_files.splice(0,1);g_selected_files.length<=0?(a=addPathSlash(g_storage.get("openurl")),doPROPFIND(a)):client.DELETE(g_selected_files[0],f)}document.oncontextmenu=function(){return!1};document.onmousedown=function(){resetTimer()};var e=String(window.navigator.userLanguage||window.navigator.language).toLowerCase(),
c=g_storage.get("lan")==void 0?e:g_storage.get("lan");m.setLanguage(c);g_storage.set("onUploading","0");g_storage.set("isOpenModalWindow","0");e="";e+="<div class='lan'>";e+="<span>"+m.getString("title_language")+"</span>";e+="<select id='menu_lan'>";e+="<option value='en' selected>"+m.getString("lan_en")+"</option>";e+="<option value='zh-tw'>"+m.getString("lan_zh-tw")+"</option>";e+="</select>";e+="</div>";$("#bottomRegion #setting").append(e);$("#menu_lan").children().each(function(){$(this).val()==
c&&$(this).attr("selected","true")});e="";e+="<div class='reg'>";e+="<span class='action'>";e+="<span class='prompt'>Hi, <cite> admin </cite></span>";e+="<span class='prompt'><a class='logout'>"+m.getString("title_logout")+"</a></span>";e+="<div class='ssettingDiv sicon'></div></span>";e+="</div>";$("#bottomRegion #setting").append(e);g_show_tree=g_storage.get("treelist")==void 0?"show":g_storage.get("treelist");showHideLoadStatus(!1);e=g_storage.get("openurl");doPROPFIND(e==void 0?"/":e);a();initPopupmenu();
initSambaPopupmenu();$("#homepage .title span").text(m.getString("btn_homepage"));$("#prevpage .title span").text(m.getString("btn_prevpage"));$("#thumbview .title span").text(m.getString("btn_thumbview"));$("#listview .title span").text(m.getString("btn_listview"));$("#btnDeleteSel .title span").text(m.getString("btn_delselect"));$("#btnUpload .title span").text(m.getString("btn_upload"));$("#btnNewDir .title span").text(m.getString("btn_newdir"));$("#btnRefresh .title span").text(m.getString("btn_refresh"));
$("#btnShareLink .title span").text(m.getString("btn_sharelink"));$("#btnRename .title span").text(m.getString("btn_rename"));$("#btnChangeUser .title span").text(m.getString("title_changeuser"));$("#modalWindow").jqm({overlay:70,modal:!0,target:"#jqmContent",onHide:function(a){$(a.w).fadeOut("2000",function(){a.o.remove();g_show_modal=0;if(g_reload_page==1){var c=addPathSlash(g_storage.get("openurl"));doPROPFIND(c)}})},onShow:function(a){var a=$(a.w),c=$("iframe",a),e=($(document).width()-g_modal_window_width)/
2;g_show_modal=1;c.attr("src",g_modal_url);a.css({width:g_modal_window_width,height:g_modal_window_height,left:999,top:50,opacity:0}).jqmShow().animate({width:g_modal_window_width,height:g_modal_window_height,top:50,left:e,marginLeft:0,opacity:1},800)}});$("div#btnDeleteSel").click(function(){!($("input:checkbox[id=c1]:checked").length<=0)&&confirm(m.getString("del_files_msg"))==!0&&(g_selected_files=null,g_selected_files=[],$("input:checkbox[id=c1]:checked").each(function(){var a=g_listview==1?$(this).parents(".content").find("a#list_item").attr("uhref"):
$(this).parents(".thumb-table-parent").find("a#list_item").attr("uhref");g_selected_files.push(a)}),client.DELETE(g_selected_files[0],f))});$("div#btnNewDir").click(function(){var a=$("div#modalWindow");g_modal_url="/smb/css/makedir.html";g_modal_window_width=200;g_modal_window_height=100;$("#jqmMsg").css("display","none");$("#jqmTitleText").text(m.getString("title_newdir"));a&&a.jqmShow()});$("div#btnRefresh").click(function(){var a=g_storage.get("openurl");doPROPFIND(a)});$("div#btnShareLink").click(function(){if(!($("input:checkbox[id=c1]:checked").length<=
0)){m.getString("email_subject");var a="",c="",e="";$("input:checkbox[id=c1]:checked").each(function(){var a;a=g_listview==1?$(this).parents(".content").find("a#list_item"):$(this).parents(".thumb-table-parent").find("a#list_item");var d=a.attr("title"),g=a.attr("uhref");a=a.attr("isdir");var f=window.location.href;a!=1&&(d=encodeURI(d),c=f=g.substring(0,g.lastIndexOf("/")),e+=d,e+=";")});client.GSL(c,c,e,86400,1,function(c,d,e){if(c==200){c=$(e).find("sharelink").text().split(";");d=c.length;for(e=
0;e<d;e++)a+=window.location.protocol+"//"+window.location.host+"/"+c[e],e!=d-1&&(a+="<br><br>");c=$("div#modalWindow");g_modal_url="/smb/css/sharelink.html?v="+a;g_modal_window_width=600;g_modal_window_height=500;$("#jqmMsg").css("display","none");$("#jqmTitleText").text(m.getString("title_sharelink"));c&&c.jqmShow()}})}});$("div#btnRename").click(function(){if($("input:checkbox[id=c1]:checked").length==1){var a=$("input:checkbox[id=c1]:checked"),c;c=g_listview==1?a.parents(".content").find("a#list_item"):
a.parents(".thumb-table-parent").find("a#list_item");var a=c.attr("title"),e=c.attr("uhref");c=c.attr("isdir");var f=$("div#modalWindow");g_modal_url="/smb/css/rename.html?o="+a+"&f="+e+"&d="+c;g_modal_window_width=500;g_modal_window_height=100;$("#jqmMsg").css("display","none");$("#jqmTitleText").text(m.getString("title_rename"));f&&f.jqmShow()}});$("div#btnChangeUser").click(function(){var a=g_storage.get("openurl");client.LOGOUT(a,function(c){c==200&&doPROPFIND(a)})});$("#homepage").click(function(){g_storage.set("openuid",
0);doPROPFIND("/")});$("#prevpage").click(function(){var a=g_storage.get("openurl"),a=addPathSlash(a);a!="/"&&(a=a.substring(0,a.length-1),a=a.substring(0,a.lastIndexOf("/")),a==""&&(a="/"));doPROPFIND(a)});$("#thumbview").click(function(){g_listview=0;g_storage.set("listview",g_listview);var a=addPathSlash($("#mainRegion").attr("url")),a=g_storage.get("openurl");$("#thumbview").css("display","none");$("#listview").css("display","block");doPROPFIND(a)});$("#listview").click(function(){g_listview=
1;g_storage.set("listview",g_listview);var a=addPathSlash($("#mainRegion").attr("url")),a=g_storage.get("openurl");$("#thumbview").css("display","block");$("#listview").css("display","none");doPROPFIND(a)});g_support_html5==1&&$("#btnUpload").click(function(){var a=addPathSlash(g_storage.get("openurl")),c=$("div#modalWindow");g_modal_url="/smb/css/upload.html?u="+a;g_modal_window_width=700;g_modal_window_height=400;$("#jqmMsg").css("display","none");$("#jqmTitleText").text(m.getString("title_upload"));
c&&c.jqmShow()});$(".ocButton").click(function(){g_show_tree=g_show_tree=="show"?"hide":"show";g_storage.set("treelist",g_show_tree);a()});$("a.logout").click(doLOGOUT);$("div.ssettingDiv").click(function(){var a=$("div#modalWindow");g_modal_url="/smb/css/setting.html";g_modal_window_width=600;g_modal_window_height=400;$("#jqmMsg").css("display","none");$("#jqmTitleText").text(m.getString("title_setting"));a&&a.jqmShow()});$("div.tree").scroll(function(){g_storage.set("treescrollLeft",$(this).scrollLeft());
g_storage.set("treescrollTop",$(this).scrollTop())});$("div#div_table_content").scroll(function(){g_storage.set("contentscrollLeft",$(this).scrollLeft());g_storage.set("contentscrollTop",$(this).scrollTop())});$("#setting #menu_lan").change(function(){var a=$(this).val();g_storage.set("lan",a);window.location.reload()});$("#logo").click(function(){g_storage.set("openuid",0);doPROPFIND("/")});$(window).resize(a)});
